TODO:
-migrate misc. shared code here
-make this not suck
